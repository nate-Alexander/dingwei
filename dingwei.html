<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=cW96ILwOzpVmoZcWl1vL2T4W"></script>
	
</head>
<body>
<style>
	body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
	#allmap{
		width:100%;
		height:100%;
	}
</style>
	<div id="allmap"></div>
	<script>
	if(navigator.geolocation){
		function success(position){
			alert('成功')
			var la=position.coords.latitude;//纬度
			var lo=position.coords.longitude;//经度
			var map = new BMap.Map("allmap");//创建map实例
			var point = new BMap.Point(lo,la);//设置一个中心点，用算好的经度和纬度
			map.centerAndZoom(point,16);//初始化地图，并且设置中心点坐标和地图的大小显示范围级别
			
			var convertor = new BMap.Convertor();//把GPS的经纬度转换为百度的经纬度
        	
    //坐标转换完之后的回调函数,用来去除偏移的函数
	translateCallback = function (data){
      if(data.status === 0) {
        var marker = new BMap.Marker(data.points[0]);
        map.addOverlay(marker);
        var label = new BMap.Label("转换后的百度坐标（正确）",{offset:new BMap.Size(20,-10)});
        marker.setLabel(label); //添加百度label
        map.setCenter(data.points[0]);
      }

    }

    
    convertor.translate([point], 1, 5, translateCallback)
		}
		function error(){
			alert('错误')
		}
		navigator.geolocation.getCurrentPosition(success,error);

	}else{
		alert('请赶紧升级浏览器吧!')
	}


	 
	</script>
</body>
</html>